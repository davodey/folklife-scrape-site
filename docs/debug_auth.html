<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auth Debug</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; }
    
        /* Authentication Styles */
        .auth-loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            backdrop-filter: blur(10px);
        }
        
        .protected-content {
            display: none;
        }
        
        .auth-section {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-left: auto;
        }
        
        .user-info {
            display: none;
            align-items: center;
            gap: 0.5rem;
            color: white;
            font-size: 0.9rem;
        }
        
        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .user-name {
            font-weight: 500;
        }
        
        .sign-out-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }
        
        .sign-out-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
        }
    
    </style>
</head>
<body>
    <h1>üîç Authentication Debug Page</h1>
    
    <div class="debug-section info">
        <h3>üìã Test Results</h3>
        <div id="testResults">Running tests...</div>
    </div>

    <div class="debug-section">
        <h3>üåê Environment Info</h3>
        <div id="envInfo"></div>
    </div>

    <div class="debug-section">
        <h3>üîê Auth Status</h3>
        <div id="authStatus"></div>
    </div>

    <div class="debug-section">
        <h3>üìù Console Logs</h3>
        <div id="consoleLogs"></div>
    </div>

    <script type="module">
        // Capture console logs
        const originalLog = console.log;
        const originalError = console.error;
        const logs = [];
        
        function captureLog(level, ...args) {
            const timestamp = new Date().toLocaleTimeString();
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            logs.push(`[${timestamp}] ${level}: ${message}`);
            updateConsoleLogs();
        }
        
        console.log = (...args) => {
            captureLog('LOG', ...args);
            originalLog.apply(console, args);
        };
        
        console.error = (...args) => {
            captureLog('ERROR', ...args);
            originalError.apply(console, args);
        };

        function updateConsoleLogs() {
            document.getElementById('consoleLogs').innerHTML = 
                logs.map(log => `<div>${log}</div>`).join('');
        }

        // Environment detection test
        function testEnvironment() {
            const hostname = window.location.hostname;
            const protocol = window.location.protocol;
            const port = window.location.port;
            
            const isDev = hostname === 'localhost' || 
                         hostname === '127.0.0.1' || 
                         hostname.includes('localhost');
            
            document.getElementById('envInfo').innerHTML = `
                <p><strong>Hostname:</strong> ${hostname}</p>
                <p><strong>Protocol:</strong> ${protocol}</p>
                <p><strong>Port:</strong> ${port}</p>
                <p><strong>Is Development:</strong> ${isDev ? '‚úÖ YES' : '‚ùå NO'}</p>
                <p><strong>Full URL:</strong> ${window.location.href}</p>
            `;
            
            return isDev;
        }

        // Test auth.js import
        async function testAuthImport() {
            try {
                console.log('üîç Testing auth.js import...');
                const authModule = await import('./auth.js');
                console.log('‚úÖ auth.js imported successfully');
                console.log('Available exports:', Object.keys(authModule));
                
                // Test environment detection
                if (typeof authModule.isDevelopment !== 'undefined') {
                    console.log('‚úÖ isDevelopment export found:', authModule.isDevelopment);
                } else {
                    console.log('‚ùå isDevelopment export not found');
                }
                
                return true;
            } catch (error) {
                console.error('‚ùå Failed to import auth.js:', error);
                return false;
            }
        }

        // Test auth middleware
        async function testAuthMiddleware() {
            try {
                console.log('üîç Testing auth_middleware.js import...');
                const middlewareModule = await import('./auth_middleware.js');
                console.log('‚úÖ auth_middleware.js imported successfully');
                console.log('Available exports:', Object.keys(middlewareModule));
                return true;
            } catch (error) {
                console.error('‚ùå Failed to import auth_middleware.js:', error);
                return false;
            }
        }

        // Run all tests
        async function runTests() {
            console.log('üöÄ Starting authentication debug tests...');
            
            const results = [];
            
            // Test 1: Environment detection
            console.log('Test 1: Environment detection');
            const isDev = testEnvironment();
            results.push(`Environment: ${isDev ? 'Development' : 'Production'}`);
            
            // Test 2: Auth.js import
            console.log('Test 2: Auth.js import');
            const authImportSuccess = await testAuthImport();
            results.push(`Auth.js import: ${authImportSuccess ? 'Success' : 'Failed'}`);
            
            // Test 3: Auth middleware import
            console.log('Test 3: Auth middleware import');
            const middlewareImportSuccess = await testAuthMiddleware();
            results.push(`Middleware import: ${middlewareImportSuccess ? 'Success' : 'Failed'}`);
            
            // Test 4: Check if auth is bypassed
            console.log('Test 4: Checking authentication bypass');
            if (isDev) {
                console.log('üöÄ Development mode detected - should bypass auth');
                results.push('Auth bypass: Should work in development');
            } else {
                console.log('üîê Production mode detected - auth required');
                results.push('Auth bypass: Not applicable in production');
            }
            
            // Update results display
            document.getElementById('testResults').innerHTML = 
                results.map(result => `<div>‚úÖ ${result}</div>`).join('');
            
            console.log('üéØ Debug tests completed');
        }

        // Start tests when page loads
        window.addEventListener('load', runTests);
    </script>

    <!-- Authentication Scripts -->
    <script type="module" src="./auth_middleware.js"></script>
    
</body>
</html>
